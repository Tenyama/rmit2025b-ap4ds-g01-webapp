{% extends 'base.html' %}

{% block header %}
<div class="container my-5">
  <div class="row align-items-center">
    <!-- Left side: Text -->
    <div class="col-lg-6">
      <h1 class="display-4 fw-bold mb-3">Find Your Perfect Fit with Real Reviews</h1>
      <p class="lead text-muted">
        Join a community of fashion-savvy shoppers. Share your experience, help others,
        and discover your next go-to outfit.
      </p>
    </div>

    <!-- Right side: Image -->
    <div class="col-lg-6 text-center text-lg-end">
      <img src="{{ url_for('static', filename='images/whitecloth.jpg') }}"
           alt="White Cloth"
           class="img-fluid rounded"
           style="max-width: 600px;">
    </div>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 m-0">Collections</h1>
  </div>

  <form method="get" action="{{ url_for('catalog.index') }}" class="row gx-2 gy-2 align-items-end mb-2">
    <div class="col-12 col-lg-4">
      <label class="form-label">Search</label>
      <input type="text" class="form-control" name="q" placeholder="Search products" value="{{ q or '' }}" />
    </div>
    <div class="col-6 col-md-2">
      <label class="form-label">Division</label>
      <select class="form-select" name="division">
        <option value="">All</option>
        {% for d in divisions or [] %}
          <option value="{{ d }}" {% if filters and filters['division'] == d %}selected{% endif %}>{{ d }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-6 col-md-2">
      <label class="form-label">Department</label>
      <select class="form-select" name="department">
        <option value="">All</option>
        {% for d in departments or [] %}
          <option value="{{ d }}" {% if filters and filters['department'] == d %}selected{% endif %}>{{ d }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-6 col-md-2">
      <label class="form-label">Category</label>
      <select class="form-select" name="class">
        <option value="">All</option>
        {% for c in classes or [] %}
          <option value="{{ c }}" {% if filters and filters['class'] == c %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-6 col-md-2">
      <label class="form-label">Sort</label>
      <select class="form-select" name="sort">
        <option value="">Default</option>
        <option value="most_recommended" {% if filters and filters['sort'] == 'most_recommended' %}selected{% endif %}>Most Recommended</option>
      </select>
    </div>
    <div class="col-12 col-md-auto">
      <button type="submit" class="btn btn-brand">Apply</button>
    </div>
  </form>

  <div class="mb-3">
    {% if q is defined %}
      <div class="text-muted">
        {{ total }} result{{ '' if (total|int == 1) else 's' }}{% if q %} for <strong>"{{ q }}"</strong>{% endif %}
      </div>
    {% endif %}
  </div>

{% if products|length == 0 %}
<div class="alert alert-warning">No items matched your search.</div>
{% endif %}

<div id="catalog-items" class="row g-3">
  {% include 'catalog/_items.html' %}
  </div>

  {% if has_next %}
  <div class="text-center mt-4">
    <button id="load-more" class="btn btn-outline-brand"
            data-next-page="{{ page + 1 }}"
            data-per-page="{{ per_page }}">
      Load more
    </button>
  </div>
  {% endif %}

<style>
    .product-card {
        border: none; /* Remove the card border */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Darker shadow */
        max-width: 90%; /* Slightly smaller width */
        height: auto; /* Adjust height dynamically */
        padding: 0.5rem; /* Add some padding */
        margin: auto; /* Center the card */
    }

    .product-card .image-frame .ratio {
        border-radius: 10px; /* More rounded corners for the image */
        overflow: hidden;
        height: 300px; /* Increase the image height */
        width: 100%; /* Maintain full width */
    }

    /* Buttons inherit global .btn-brand / .btn-outline-brand */

    .product-card .card-footer {
        display: flex;
        /* justify-content: space-between; */
        font-weight: bold;
        align-items: center;
    }

    .product-card .tags {
        padding-bottom: 1rem; /* Add padding to the bottom of the tags */
    }

    .product-card .title {
        text-transform: uppercase; /* Make the title uppercase */
        color: #104163; /* Set the title color */
    }
</style>
<script>
  (function(){
    const btn = document.getElementById('load-more');
    if(!btn) return;
    const itemsEl = document.getElementById('catalog-items');
    const baseParams = new URLSearchParams(window.location.search);

    btn.addEventListener('click', async function(){
      btn.disabled = true;
      btn.textContent = 'Loading...';
      const page = btn.getAttribute('data-next-page');
      const perPage = btn.getAttribute('data-per-page') || '24';
      const params = new URLSearchParams(baseParams.toString());
      params.set('page', page);
      params.set('per_page', perPage);
      try {
        const resp = await fetch(`{{ url_for('catalog.data') }}?${params.toString()}`);
        const data = await resp.json();
        itemsEl.insertAdjacentHTML('beforeend', data.items_html);
        if (data.has_next && data.next_page){
          btn.setAttribute('data-next-page', data.next_page);
          btn.disabled = false;
          btn.textContent = 'Load more';
        } else {
          btn.remove();
        }
      } catch(err){
        console.error(err);
        btn.disabled = false;
        btn.textContent = 'Load more';
      }
    });
  })();
  </script>
{% endblock %}
